import{u as J,a as N,r as a,k as M,l as O,m as T,j as s,n as A,o as B,p as P,g as Q,q as V,t as Z,v as ss,w as es}from"./index-CUtGss9Q.js";import{u as W}from"./useInput-DTV-J8-R.js";import{A as ts,m as $,C as as}from"./ChangeModal-0SYffArl.js";function ls({show:o,onClose:m}){const d=J(),n=N(i=>i.isLostAdd),b=N(i=>i.isLostAdded),[l,y]=a.useState(!1),[c,w]=W(""),[v,D]=W(""),[u,L]=a.useState(null),S=a.useRef(null);a.useEffect(()=>{n&&(y(!1),d(M(!1)),b&&(d(O(!1)),d(T({is_me:1,limit:1e3})),m()))},[n,b,d,m]),a.useEffect(()=>{document.body.style.overflow=o?"hidden":"auto"},[o]);async function _(){if(!c){A("Judul tidak boleh kosong");return}if(!v){A("Deskripsi tidak boleh kosong");return}y(!0);const i="lost";try{const R=(await B.postLostFound(c,v,i)).lost_found_id;u?(await B.postLostFoundCover(R,u),P("Data dan gambar berhasil ditambahkan!")):P("Data dasar berhasil ditambahkan."),d(O(!0))}catch(k){A(k.message||"Gagal menyimpan data."),d(O(!1))}d(M(!0))}return s.jsx(ts,{children:o&&s.jsxs(s.Fragment,{children:[s.jsx($.div,{initial:{opacity:0},animate:{opacity:.75},exit:{opacity:0},transition:{duration:.3},className:"modal-backdrop fade show",onClick:m,style:{zIndex:1050}}),s.jsx($.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},transition:{type:"spring",damping:25,stiffness:200},className:"modal fade show",tabIndex:"-1",role:"dialog",style:{zIndex:1060,display:"block"},children:s.jsx("div",{className:"modal-dialog modal-dialog-centered",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header bg-light",children:[s.jsx("h1",{className:"modal-title fs-5",children:"Tambah Barang Hilang"}),s.jsx("button",{type:"button",className:"btn-close",onClick:m,"aria-label":"Close"})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"addLfTitle",className:"form-label",children:"Judul"}),s.jsx("input",{type:"text",id:"addLfTitle",name:"title",onChange:w,className:"form-control",disabled:l})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"addLfDescription",className:"form-label",children:"Deskripsi"}),s.jsx("textarea",{id:"addLfDescription",name:"description",onChange:D,className:"form-control",rows:"3",disabled:l})]}),s.jsxs("div",{className:"mb-3",children:[s.jsx("label",{htmlFor:"addLfCover",className:"form-label",children:"Foto Barang (Opsional)"}),s.jsx("input",{type:"file",id:"addLfCover",name:"cover",accept:"image/*",ref:S,onChange:i=>L(i.target.files[0]),className:"form-control",disabled:l}),u&&s.jsxs("small",{className:"text-muted",children:["File terpilih: ",u.name]})]})]}),s.jsxs("div",{className:"modal-footer bg-light",children:[s.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:m,disabled:l,children:[s.jsx("i",{className:"bi bi-x-circle"})," Batal"]}),l?s.jsxs("button",{type:"button",className:"btn btn-primary",disabled:!0,children:[s.jsx("span",{className:"spinner-border spinner-border-sm"}),"Â Menyimpan..."]}):s.jsxs("button",{type:"button",className:"btn btn-primary",onClick:_,children:[s.jsx("i",{className:"bi bi-save"})," Simpan"]})]})]})})})]})})}function ds(){const o=J(),m=Q(),d=N(e=>e.profile),n=N(e=>e.lostFounds),b=N(e=>e.isLostFoundDeleted),[l,y]=a.useState(""),[c,w]=a.useState(!0),[v,D]=a.useState(!1),[u,L]=a.useState(!1),[S,_]=a.useState(null),[i,k]=a.useState(new Date);if(a.useEffect(()=>{const e=setInterval(()=>k(new Date),1e3);return()=>clearInterval(e)},[]),["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"][i.getDay()],i.toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"}),i.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),a.useEffect(()=>{let e={};l&&(l==="lost"||l==="found")&&(e.status=l),c&&(e.is_me=1),e.limit=1e3,o(T(e))},[l,c,o]),a.useEffect(()=>{if(b){o(V(!1));let e={};c&&(e.is_me=1),e.limit=1e3,o(T(e))}},[b,c,o]),!d)return null;function z(e){ss("Hapus Lost & Found").then(t=>{t.isConfirmed&&o(es(e))})}const G=n.length,K=n.filter(e=>e.status==="lost").length,U=n.filter(e=>e.status==="found").length,q="#f5f7fb",g="#dbe2ef",j="#3f72af",H="#ff6f61",X="#66bb6a",F="#2f2f2f",I="#1e56a0",E="#ffffff",Y={backgroundColor:g},p={backgroundColor:E,border:`1px solid ${g}`};return s.jsxs("div",{className:"main-content",style:{backgroundColor:q,minHeight:"100vh"},children:[s.jsxs("div",{className:"container-fluid mt-3",children:[s.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[s.jsx("h2",{style:{color:I},children:"Dashboard Lost & Found"}),s.jsxs("div",{className:"d-flex gap-3",children:[s.jsxs("div",{className:"input-group",style:{maxWidth:"300px"},children:[s.jsx("span",{className:"input-group-text",style:{...Y,color:F},children:"Filter Status"}),s.jsxs("select",{className:"form-select",value:l,onChange:e=>y(e.target.value),style:{backgroundColor:"#fff",color:F,borderColor:g},children:[s.jsx("option",{value:"",children:"Semua"}),s.jsx("option",{value:"lost",children:"Hilang"}),s.jsx("option",{value:"found",children:"Ditemukan"})]})]}),s.jsxs("button",{type:"button",className:"btn",onClick:()=>D(!0),style:{backgroundColor:j,color:"#fff",fontWeight:"500"},children:[s.jsx("i",{className:"bi bi-plus"})," Tambah Item"]})]})]}),s.jsx("hr",{style:{borderColor:g}}),s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-md-4 mb-4",children:s.jsx("div",{className:"card shadow-sm",style:{...p},children:s.jsxs("div",{className:"card-body",children:[s.jsx("h5",{className:"card-title text-secondary",children:"Total Item"}),s.jsx("h2",{className:"card-text",children:G})]})})}),s.jsx("div",{className:"col-md-4 mb-4",children:s.jsx("div",{className:"card shadow-sm",style:{...p},children:s.jsxs("div",{className:"card-body",children:[s.jsx("h5",{className:"card-title text-danger",children:"Item Hilang"}),s.jsx("h2",{className:"card-text",children:K})]})})}),s.jsx("div",{className:"col-md-4 mb-4",children:s.jsx("div",{className:"card shadow-sm",style:{...p},children:s.jsxs("div",{className:"card-body",children:[s.jsx("h5",{className:"card-title text-success",children:"Item Ditemukan"}),s.jsx("h2",{className:"card-text",children:U})]})})})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{style:{color:I},children:"Statistik Barang Hilang & Ditemukan"}),s.jsxs("div",{className:"row mt-3",children:[s.jsx("div",{className:"col-md-6 mb-4",children:s.jsx("div",{className:"card shadow-sm",style:p,children:s.jsxs("div",{className:"card-body",children:[s.jsx("h5",{className:"card-title text-center mb-3",style:{color:j},children:"Statistik Mingguan (7 Hari Terakhir)"}),(()=>{const e=new Date,t=new Date;t.setDate(e.getDate()-6);const f=n.filter(h=>{const x=new Date(h.created_at);return x>=t&&x<=e});if(f.length===0)return s.jsx("p",{className:"text-muted text-center mb-0",children:"Tidak ada data minggu ini."});const r={};return f.forEach(h=>{const C=new Date(h.created_at).toLocaleDateString("id-ID",{weekday:"long",day:"2-digit",month:"2-digit"});r[C]||(r[C]={lost:0,found:0}),h.status==="lost"&&r[C].lost++,h.status==="found"&&r[C].found++}),s.jsx("ul",{className:"list-group",children:Object.entries(r).map(([h,x])=>s.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[s.jsx("span",{children:h}),s.jsxs("span",{children:[s.jsxs("span",{className:"badge bg-danger me-2",children:["Hilang: ",x.lost]}),s.jsxs("span",{className:"badge bg-success",children:["Ditemukan: ",x.found]})]})]},h))})})()]})})}),s.jsx("div",{className:"col-md-6 mb-4",children:s.jsx("div",{className:"card shadow-sm",style:p,children:s.jsxs("div",{className:"card-body",children:[s.jsx("h5",{className:"card-title text-center mb-3",style:{color:j},children:"Statistik Bulanan"}),(()=>{if(n.length===0)return s.jsx("p",{className:"text-muted text-center mb-0",children:"Tidak ada data bulanan."});const e={};return n.forEach(t=>{const r=new Date(t.created_at).toLocaleDateString("id-ID",{month:"long",year:"numeric"});e[r]||(e[r]={lost:0,found:0}),t.status==="lost"&&e[r].lost++,t.status==="found"&&e[r].found++}),s.jsx("ul",{className:"list-group",children:Object.entries(e).map(([t,f])=>s.jsxs("li",{className:"list-group-item d-flex justify-content-between align-items-center",children:[s.jsx("span",{children:t}),s.jsxs("span",{children:[s.jsxs("span",{className:"badge bg-danger me-2",children:["Hilang: ",f.lost]}),s.jsxs("span",{className:"badge bg-success",children:["Ditemukan: ",f.found]})]})]},t))})})()]})})})]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("h4",{style:{color:I},children:"Daftar Item Lost & Found"}),s.jsxs("div",{className:"form-check form-switch mb-3",children:[s.jsx("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"showMineSwitch",checked:c,onChange:()=>w(!c)}),s.jsx("label",{className:"form-check-label",htmlFor:"showMineSwitch",style:{color:F},children:c?"Hanya Tampilkan Data Saya":"Tampilkan Semua Data"})]}),s.jsx("div",{className:"row",children:n.length===0?s.jsxs("div",{className:"col-12 text-center py-5 text-muted",children:[s.jsx("i",{className:"bi bi-info-circle me-2"}),"Belum ada data Lost & Found."]}):n.map(e=>s.jsx("div",{className:"col-lg-3 col-md-4 col-sm-6 mb-4",children:s.jsxs("div",{className:"card h-100 shadow-sm",style:{backgroundColor:E,border:`1px solid ${g}`,cursor:"pointer"},onClick:()=>m(`/lost-founds/${e.id}`),children:[s.jsx("div",{style:{height:"180px",overflow:"hidden"},children:s.jsx("img",{src:e.cover||"/default-cover.png",className:"card-img-top",alt:e.title,style:{width:"100%",height:"100%",objectFit:"cover"}})}),s.jsxs("div",{className:"card-body",children:[s.jsx("h5",{className:"card-title text-truncate",style:{color:j},children:e.title}),s.jsxs("p",{className:"card-text small text-muted mb-2",children:[s.jsx("i",{className:"bi bi-calendar me-1"})," ",Z(e.created_at)]}),s.jsx("span",{className:"badge",style:{backgroundColor:e.status==="found"?X:H,color:"#fff"},children:e.status==="found"?"Ditemukan":"Hilang"}),s.jsxs("div",{className:"d-flex justify-content-between mt-3",children:[s.jsx("button",{className:"btn btn-sm",onClick:t=>{t.stopPropagation(),m(`/lost-founds/${e.id}`)},style:{backgroundColor:j,color:"#fff",fontWeight:"500"},children:"Detail"}),e.user_id===d.id&&s.jsx("button",{className:"btn btn-sm",onClick:t=>{t.stopPropagation(),z(e.id)},style:{backgroundColor:H,color:"#fff",fontWeight:"500"},children:"Hapus"})]})]})]})},e.id))})]})]}),s.jsx(ls,{show:v,onClose:()=>D(!1)}),s.jsx(as,{show:u,onClose:()=>L(!1),lostFoundId:S})]})}export{ds as default};
